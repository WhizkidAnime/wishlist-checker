# Руководство по тестированию - Мой Вишлист

## 📋 Что такое эти тесты?

Я создал **4 простых unit теста** для самых критичных функций вашего приложения:

### ✅ Созданные тесты:

1. **`priceCalculator.test.ts`** - Тестирует парсер цен (функция `safeCalculate`)
   - Проверяет корректность вычисления выражений типа "45000+500"
   - Проверяет безопасность от вредоносного кода
   - Проверяет обработку некорректных данных

2. **`localStorageUtils.test.ts`** - Тестирует сохранение/загрузку данных
   - Проверяет сохранение товаров в localStorage
   - Проверяет корректную загрузку данных
   - Проверяет обработку ошибок JSON

3. **`useTheme.test.ts`** - Тестирует систему тем
   - Проверяет переключение между светлой и темной темой
   - Проверяет сохранение выбранной темы
   - Проверяет обновление CSS классов

4. **`useWishlist.test.ts`** - Тестирует основную логику приложения
   - Проверяет добавление/удаление товаров
   - Проверяет поиск и сортировку
   - Проверяет подсчет общих сумм

## 🚀 Как установить и запустить тесты

### Шаг 1: Установка зависимостей
```bash
npm install
```

### Шаг 2: Запуск тестов
```bash
# Запустить тесты один раз
npm run test:run

# Запустить тесты в режиме наблюдения (обновляются при изменении кода)
npm test

# Запустить тесты с UI интерфейсом (если установлен @vitest/ui)
npm run test:ui
```

## 📊 Что означают результаты тестов

### ✅ Успешный результат выглядит так:
```
✓ priceCalculator.test.ts (7 tests) 2ms
  ✓ должен корректно вычислять простые числа
  ✓ должен корректно вычислять математические выражения
  ✓ должен игнорировать пробелы
  ✓ должен возвращать null для некорректных выражений
  ✓ должен обрабатывать деление на ноль
  ✓ должен корректно работать с отрицательными числами

✓ localStorageUtils.test.ts (5 tests) 3ms
✓ useTheme.test.ts (8 tests) 12ms
✓ useWishlist.test.ts (8 tests) 15ms

Test Files  4 passed (4)
Tests       28 passed (28)
```

### ❌ Если тест упал:
```
✗ priceCalculator.test.ts > должен корректно вычислять простые числа
  AssertionError: expected null to be 45500
```

Это означает, что функция `safeCalculate` работает не так, как ожидалось.

## 🔧 Как понимать, что тестируют эти тесты

### 1. **Тест парсера цен** проверяет:
```javascript
// Эти выражения должны работать:
safeCalculate('45500') → 45500
safeCalculate('45000+500') → 45500
safeCalculate('45 500') → 45500

// Эти должны вернуть null (защита от хакеров):
safeCalculate('alert("hack")') → null
safeCalculate('45000++') → null
```

### 2. **Тест localStorage** проверяет:
```javascript
// Сохранение данных должно работать:
saveToLocalStorage('test', [товар]) → данные сохраняются

// Загрузка данных должна работать:
loadFromLocalStorage('test') → возвращает сохраненные товары
```

### 3. **Тест тем** проверяет:
```javascript
// Переключение темы должно работать:
toggleTheme() → тема меняется с light на dark
setTheme('dark') → сохраняется в localStorage
```

### 4. **Тест вишлиста** проверяет:
```javascript
// Основные операции должны работать:
handleAddItem(товар) → товар добавляется в список
handleToggleBought(id) → статус "куплено" меняется
setSearchQuery('iPhone') → показываются только iPhone
```

## 🎯 Зачем это нужно

### **Автоматическая проверка при изменениях:**
- Изменили функцию `safeCalculate`? → Тест сразу покажет, не сломалась ли она
- Переделали `useTheme`? → Тест проверит, что переключение тем работает
- Обновили `useWishlist`? → Тест убедится, что добавление товаров не сломалось

### **Уверенность в коде:**
- Перед деплоем можете запустить `npm run test:run`
- Если все тесты проходят ✅ → код готов к production
- Если тесты падают ❌ → есть проблемы, которые нужно исправить

### **Документация кода:**
Тесты показывают, **как должны работать** ваши функции. Это живая документация!

## 🚀 Как добавить новые тесты

Если захотите протестировать новую функцию, создайте файл `новаяФункция.test.ts`:

```javascript
import { describe, it, expect } from 'vitest'
import { новаяФункция } from '../новаяФункция'

describe('новаяФункция', () => {
  it('должна делать то, что нужно', () => {
    expect(новаяФункция('вход')).toBe('ожидаемый результат')
  })
})
```

## 🔍 Структура тестов

```
src/
├── utils/
│   ├── __tests__/
│   │   ├── priceCalculator.test.ts
│   │   └── localStorageUtils.test.ts
│   ├── priceCalculator.ts
│   └── localStorageUtils.ts
├── hooks/
│   ├── __tests__/
│   │   ├── useTheme.test.ts
│   │   └── useWishlist.test.ts
│   ├── useTheme.ts
│   └── useWishlist.ts
```

## ⚠️ Известные ограничения

1. **Linter ошибки**: Пока не все типы установлены, ESLint может показывать ошибки
2. **Моки**: В тестах используются моки (подделки) для localStorage и DOM API
3. **Простота**: Это базовые unit тесты, можно расширить integration тестами

## 🎉 Заключение

Эти 4 теста покрывают **основные критичные функции** вашего приложения:
- ✅ Безопасность парсера цен
- ✅ Надежность сохранения данных  
- ✅ Корректность системы тем
- ✅ Работоспособность основной логики вишлиста

Запускайте их перед важными изменениями, и они помогут избежать багов! 🚀 